#!/bin/bash

TESTFILE="builtins"

assert() {
    #!/bin/bash
	echo "ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥";
	echo "                                                                                             ";
	echo " â–ˆâ–ˆ    â–ˆâ–ˆ â–ˆ â–ˆâ–ˆ    â–ˆ â–ˆ â–ˆâ–ˆâ–ˆâ–ˆâ–ˆ â–ˆ   â–ˆ â–ˆâ–ˆâ–ˆâ–ˆâ–ˆ â–ˆ     â–ˆ       â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ â–ˆâ–ˆâ–ˆâ–ˆâ–ˆ â–ˆâ–ˆâ–ˆâ–ˆâ–ˆ â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ â–ˆâ–ˆâ–ˆâ–ˆâ–ˆ â–ˆâ–ˆâ–ˆâ–ˆâ–ˆ  ";
	echo " â–ˆâ–ˆâ–ˆ  â–ˆâ–ˆâ–ˆ â–ˆ â–ˆâ–ˆâ–ˆ   â–ˆ â–ˆ â–ˆ     â–ˆ   â–ˆ â–ˆ     â–ˆ     â–ˆ         â–ˆâ–ˆ   â–ˆ     â–ˆ       â–ˆâ–ˆ   â–ˆ     â–ˆ   â–ˆâ–ˆ ";
	echo " â–ˆ â–ˆâ–ˆâ–ˆâ–ˆ â–ˆ â–ˆ â–ˆ â–ˆâ–ˆ  â–ˆ â–ˆ â–ˆâ–ˆâ–ˆâ–ˆâ–ˆ â–ˆâ–ˆâ–ˆâ–ˆâ–ˆ â–ˆâ–ˆâ–ˆâ–ˆ  â–ˆ     â–ˆ         â–ˆâ–ˆ   â–ˆâ–ˆâ–ˆâ–ˆ  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆ   â–ˆâ–ˆ   â–ˆâ–ˆâ–ˆâ–ˆ  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆ  ";
	echo " â–ˆ  â–ˆâ–ˆ  â–ˆ â–ˆ â–ˆ  â–ˆâ–ˆ â–ˆ â–ˆ     â–ˆ â–ˆ   â–ˆ â–ˆ     â–ˆ     â–ˆ         â–ˆâ–ˆ   â–ˆ         â–ˆ   â–ˆâ–ˆ   â–ˆ     â–ˆ   â–ˆâ–ˆ ";
	echo " â–ˆ      â–ˆ â–ˆ â–ˆ   â–ˆâ–ˆâ–ˆ â–ˆ â–ˆâ–ˆâ–ˆâ–ˆâ–ˆ â–ˆ   â–ˆ â–ˆâ–ˆâ–ˆâ–ˆâ–ˆ â–ˆâ–ˆâ–ˆâ–ˆâ–ˆ â–ˆâ–ˆâ–ˆâ–ˆâ–ˆ     â–ˆâ–ˆ   â–ˆâ–ˆâ–ˆâ–ˆâ–ˆ â–ˆâ–ˆâ–ˆâ–ˆâ–ˆ   â–ˆâ–ˆ   â–ˆâ–ˆâ–ˆâ–ˆâ–ˆ â–ˆ   â–ˆâ–ˆ ";
	echo "                                                                                             ";
	echo "ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥";
	echo "                                                                                              ";
    while IFS= read -r line; do    
        TEST=$line
    # break
    # ãƒ†ã‚¹ãƒˆã—ã‚ˆã†ã¨ã—ã¦ã„ã‚‹å†…å®¹ã‚’print
	printf '\033[34m%s\033[m\n' "****************************TEST***************************"
	printf '\n%s\n' "****************************TEST***************************" >> log
	printf '%-30s:' "\"$TEST\""
	printf '%-30s:' "\"$TEST\"" >>log

	# bashã®å‡ºåŠ›ã‚’cmpã«ä¿å­˜
	# echo -n -e "$TEST" | bash >cmp 2>&-
	echo -n -e "$TEST" | ../minishell >out 2>&-
	echo -n -e "$TEST" | bash >cmp 2>&-
	# bashã®exit statusã‚’expectedã«ä»£å…¥
	expected=$?
	# minishellã®å‡ºåŠ›ã‚’outã«ä¿å­˜
	# minishellã®exit statusã‚’actualã«ä»£å…¥
	actual=$?

	# bashã¨minishellã®å‡ºåŠ›ã‚’æ¯”è¼ƒ
	diff cmp out >>/dev/null && printf '\n\033[34m%s\033[m\n' "  diff OK" || printf '\n\033[31m%s\033[m\n' "  diff KO"
	diff cmp out >>/dev/null || printf '\n%s\n%s\n' "  diff KO" " æœ¬å®¶" >> log
	diff cmp out >>/dev/null || cat cmp >> log
	diff cmp out >>/dev/null || printf '\n%s\n'" minishell" >> log
	diff cmp out >>/dev/null || cat out >> log


	# bashã¨minishellã®exit statusã‚’æ¯”è¼ƒ
	if [ "$actual" = "$expected" ]; then
		printf '\033[34m%s\033[m\n' "  status OK"
	else
		printf '\033[31m%s\033[m\n' "  status NG, expected $expected but got $actual"
	fi
	echo

    done < $TESTFILE
}

assert ''